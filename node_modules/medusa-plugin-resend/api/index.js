"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const cors_1 = __importDefault(require("cors"));
const config_1 = __importDefault(require("@medusajs/medusa/dist/loaders/config"));
const express_1 = require("express");
const body_parser_1 = __importDefault(require("body-parser"));
const utils_1 = require("@medusajs/utils");
const zod_1 = require("zod");
const router = (0, express_1.Router)();
exports.default = (rootDirectory) => {
    const config = (0, config_1.default)(rootDirectory);
    const storeCorsOptions = { origin: config.projectConfig.store_cors.split(","), credentials: true, };
    const adminCorsOptions = { origin: config.projectConfig.admin_cors.split(","), credentials: true, };
    router.use("resend/send", body_parser_1.default.json());
    router.post("/resend/send", (0, cors_1.default)(storeCorsOptions), (req, res) => {
        const resendService = req.scope.resolve("resendService");
        const schema = zod_1.z.object({
            template_id: zod_1.z.string().min(1),
            from: zod_1.z.string().min(1),
            to: zod_1.z.string().min(1),
            data: zod_1.z.object({}).passthrough(),
        });
        const { success, error, data } = schema.safeParse(req.body);
        if (!success) {
            throw new utils_1.MedusaError(utils_1.MedusaError.Types.INVALID_DATA, error);
        }
        resendService.sendEmail(data.template_id, data.from, data.to, data.data).then((result) => {
            return res.json({
                result
            });
        });
    });
    return router;
};
//# sourceMappingURL=index.js.map